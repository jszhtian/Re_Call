//=========================================================================
//
//Å°ç~âJèàóù
//
//=========================================================================

//Å°ÉXÉ^ÉeÉBÉbÉNïœêîêÈåæ
{
	S_INT[@Rain.SP.X(256)]
	S_INT[@Rain.SP.Y(256)]
	S_INT[@Rain.A(256)]
	S_INT[@Rain.Rad(256)]
	S_INT[@Rain.ED.Y(256)]
	S_FLT[@Rain.X(256)]
	S_FLT[@Rain.Y(256)]
	S_FLT[@fVal]
	S_INT[@Count]
	S_INT[@mode]
	S_INT[@mA]
	S_INT[@mEndCount]

	S_INT[@wait=2]
	S_INT[@rainsp=1000]

	S_STR[$fn.rain(3)]
	S_INT[@Z.RAIN(3)]
	S_INT[@RAIN.NUM(3)]

}

//===============================================================
//Å°
//===============================================================
#=es.RAINMODE
{
	IF[@es.RAINMODE==0]
	{
		@es.LSD(032,33) = 150  //âJZ1
		@es.LSD(032,34) = 250  //âJZ2

		//âJâÊëúÉtÉ@ÉCÉãñº
		$fn.rain(1) = "cg/rain_1"
		$fn.rain(2) = "cg/rain_2"

	@RAIN.NUM(1)=60
	@RAIN.NUM(2)=30

		//óDêÊèáà 
		@Z.RAIN(1) = @es.Z.SP+09000*@es.ZEX-(@es.LSD(032,33))*@es.ZEX
		@Z.RAIN(2) = @es.Z.SP+09000*@es.ZEX-(@es.LSD(032,34))*@es.ZEX
	//	@Z.RAIN(1) = @es.Z.SP+10*(08)
	//	@Z.RAIN(2) = @es.Z.SP+10*(98)

		GOSUB[#=es.RAINMODE.CGLOAD]

		LOOP[SET=@RAIN.NUM(1)]
		{
			@Rain.X(@_LC) = @_LC*10
			\_rnd(0,200)
			@Rain.Y(@_LC) = @_RINT(1) + 600
			\_rnd(256,256)
			@Rain.A(@_LC) = @_RINT(1)

			@Rain.SP.Y(@_LC) = @rainsp

			\_rnd(0,40)
			@Rain.ED.Y(@_LC) = @_RINT(1) + 600
		}
		LOOPEND[]

		LOOP[SET=@RAIN.NUM(2)]
		{
			@Rain.X(@RAIN.NUM(1)+@_LC) = @_LC*10
			\_rnd(0,200)
			@Rain.Y(@RAIN.NUM(1)+@_LC) = @_RINT(1) + 600
			\_rnd(256,256)
			@Rain.A(@RAIN.NUM(1)+@_LC) = @_RINT(1)

			\_rnd(50,100)
			@Rain.SP.Y(@RAIN.NUM(1)+@_LC) = @rainsp+@_RINT(1)

			\_rnd(0,40)
			@Rain.ED.Y(@RAIN.NUM(1)+@_LC) = @_RINT(1) + 600
		}
		LOOPEND[]
	}
	IFEND[]

	@mEndCount=0
	@es.RAINMODE = 1
	@mA=0

	return[]
}


//===============================================================
//Å°ÉÅÉCÉì
//===============================================================
#=es.RAINMODE.MAIN
{

	@mode+=1
	IF[@mode%@wait==0]
	{
		GOSUB[#=es.RAINMODE.MAIN.Calc pint=0 pint2=@RAIN.NUM(1) pint3=02 pint4=0 pint5=2 pint6=2] //è¨
//		GOSUB[#=es.RAINMODE.MAIN.Calc pint=1 pint2=@RAIN.NUM(2) pint3=10 pint4=0 pint5=1 pint6=20] //ëÂ
	}
	IFEND[]
	IF[@mode%@wait==1]
	{
//		GOSUB[#=es.RAINMODE.MAIN.Calc pint=0 pint2=@RAIN.NUM(1) pint3=02 pint4=0 pint5=2 pint6=2] //è¨
		GOSUB[#=es.RAINMODE.MAIN.Calc pint=1 pint2=@RAIN.NUM(2) pint3=10 pint4=0 pint5=1 pint6=20] //ëÂ
	}
	IFEND[]

	@Count+=1

	IF[@es.RAINMODE==1]
	{
		@mA+=2
		\_range(@mA,, 256)
	}
	IFEND[]

	IF[@es.RAINMODE==2]
	{
		//@mEndCount+=1
		//IF[@mEndCount>=100]
		@mA-=2
		IF[@mA<=0]
		{
			@mA=0
			GOSUB[#=es.RAINMODE.DEL]
		}
		IFEND[]

	}
	IFEND[]

	return[]
}


//===============================================================
//Å°
//===============================================================
#=es.RAINMODE.MAIN.Calc
{

	INT[@id]
	INT[@NUM=@_PINT(2)] //êî
	INT[@MAX=@_PINT(3)]

		INT[@dummy=@_PINT(4)]

	INT[@CYCLE=@_PINT(5)]
	FLT[@SCALE=@_PINT(6)/10.0]

	INT[@mmA]

	LOOP[SET=@NUM]
	{
		//----------------------------------------------------------------
		// åvéZ
		//----------------------------------------------------------------
			@id = @_LC + @_PINT(1)*@RAIN.NUM(1)

			\_rnd(0,@MAX)
			@Rain.SP.X(@id) = @_RINT(1) - @MAX/2

			MATH[COS=1 LET=@fVal SET=(@Rain.Rad(@id)+@Count*@CYCLE) * @_PAI / 180]
			@Rain.X(@id) += @fVal * @SCALE
			@Rain.X(@id) += @Rain.SP.X(@id) / 10.0
			@Rain.Y(@id) += @Rain.SP.Y(@id) / 10.0


			//IF[@mEndCount==0]
			{
				IF[@Rain.Y(@id) > @Rain.ED.Y(@id)]
				{
					\_rnd(0,799)
					@Rain.X(@id) = @_RINT(1) - 8

					\_rnd(0,600)
					@Rain.Y(@id) -= 600 + 100 + @_RINT(1)

			//		@Rain.A(@id) = 256

					\_rnd(0,360)
					@Rain.Rad(@id) = @_RINT(1)
				}
				IFEND[]
			}
			//IFEND[]

		//----------------------------------------------------------------
		// ï\é¶
		//----------------------------------------------------------------
			IF[@_PINT(1)==0] CG[ID="es.RAIN1."+$(@_LC) X=@Rain.X(@id) Y=@Rain.Y(@id) A=@Rain.A(@id)*@mA*(@es.GSD(112,01)==0)/256] IFEND[]
			IF[@_PINT(1)==1] CG[ID="es.RAIN2."+$(@_LC) X=@Rain.X(@id) Y=@Rain.Y(@id) A=@Rain.A(@id)*@mA*(@es.GSD(112,01)==0)/256] IFEND[]
		//	IF[@_PINT(1)==0] CG[ID="es.RAIN1."+$(@_LC) X=@Rain.X(@id) Y=600-16-@Rain.Y(@id) A=@Rain.A(@id)*@mA/256] IFEND[]
		//	IF[@_PINT(1)==1] CG[ID="es.RAIN2."+$(@_LC) X=@Rain.X(@id) Y=600-16-@Rain.Y(@id) A=@Rain.A(@id)*@mA/256] IFEND[]
	}
	LOOPEND[]

	return[]
}

//===============================================================
//Å°
//===============================================================
#=es.RAINMODE.CGLOAD
{
	LOOP[SET=@RAIN.NUM(1)] CG[ID="es.RAIN1."+$(@_LC) Z=@Z.RAIN(1) A=0 FILE=$fn.rain(1) MODE=0] LOOPEND[] //è¨
	LOOP[SET=@RAIN.NUM(2)] CG[ID="es.RAIN2."+$(@_LC) Z=@Z.RAIN(2) A=0 FILE=$fn.rain(2) MODE=0] LOOPEND[] //ëÂ

	return[]
}

//===============================================================
//Å°
//===============================================================
#=es.RAINMODE.SAVE
{
	return[]
}

//===============================================================
//Å°
//===============================================================
#=es.RAINMODE.LOAD
{
	return[]
}

//===============================================================
//Å°
//===============================================================
#=es.RAINMODE.END
{
	@es.RAINMODE = 2
	return[]
}

//===============================================================
//Å°
//===============================================================
#=es.RAINMODE.DEL
{
	//ÉåÉCÉÑè¡ãé
	LOOP[SET=@RAIN.NUM(1)] CGEND[ID="es.RAIN1."+$(@_LC)] LOOPEND[]
	LOOP[SET=@RAIN.NUM(2)] CGEND[ID="es.RAIN2."+$(@_LC)] LOOPEND[]

	@es.RAINMODE = 0

	return[]
}

